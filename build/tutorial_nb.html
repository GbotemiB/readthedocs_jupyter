
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Filters &#8212; test v1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to test’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<p>##<em>Installation</em> <em>We use PyPI to install Zarr.</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pandoc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: pandoc in /home/gbotemi/.local/lib/python3.10/site-packages (2.2)
Requirement already satisfied: ply in /home/gbotemi/.local/lib/python3.10/site-packages (from pandoc) (3.11)
Requirement already satisfied: plumbum in /home/gbotemi/.local/lib/python3.10/site-packages (from pandoc) (1.8.0)
Note: you may need to restart the kernel to use updated packages.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">zarr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: zarr in /home/gbotemi/.local/lib/python3.10/site-packages (2.13.3)
Requirement already satisfied: numcodecs&gt;=0.10.0 in /home/gbotemi/.local/lib/python3.10/site-packages (from zarr) (0.10.2)
Requirement already satisfied: numpy&gt;=1.7 in /home/gbotemi/.local/lib/python3.10/site-packages (from zarr) (1.23.2)
Requirement already satisfied: fasteners in /usr/lib/python3/dist-packages (from zarr) (0.14.1)
Requirement already satisfied: asciitree in /home/gbotemi/.local/lib/python3.10/site-packages (from zarr) (0.3.3)
Requirement already satisfied: typing-extensions&gt;=3.7.4 in /home/gbotemi/.local/lib/python3.10/site-packages (from numcodecs&gt;=0.10.0-&gt;zarr) (4.3.0)
Requirement already satisfied: entrypoints in /home/gbotemi/.local/lib/python3.10/site-packages (from numcodecs&gt;=0.10.0-&gt;zarr) (0.4)
Note: you may need to restart the kernel to use updated packages.
</pre></div></div>
</div>
<p>#Tutorial</p>
<p>Zarr provides classes and functions for working with N-dimensional arrays that behave like NumPy arrays but whose data is divided into chunks and each chunk is compressed. If you are already familiar with HDF5 then Zarr arrays provide similar functionality, but with some additional flexibility.</p>
<p>##Creating an Array</p>
<p>Zarr has several functions for creating arrays. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zarr</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>The code above creates a 2-dimensional array of 32-bit integers with 10000 rows and 10000 columns, divided into chunks where each chunk has 1000 rows and 1000 columns (and so there will be 100 chunks in total).</p>
<p>For a complete list of array creation routines see the <code class="docutils literal notranslate"><span class="pre">`zarr.creation</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/creation.html#module-zarr.creation">https://zarr.readthedocs.io/en/stable/api/creation.html#module-zarr.creation</a>&gt;`__ module documentation.</p>
<p>##Reading and Writing Data</p>
<p>Zarr arrays support a similar interface to NumPy arrays for reading and writing data. For example, the entire array can be filled with a scalar value:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
<p>Regions of the array can also be written to, e.g.:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The contents of the array can be retrieved by slicing, which will load the requested region into memory as a NumPy array, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
42
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([   0,    1,    2, ..., 9997, 9998, 9999], dtype=int32)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([   0,    1,    2, ..., 9997, 9998, 9999], dtype=int32)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[   0,    1,    2, ..., 9997, 9998, 9999],
       [   1,   42,   42, ...,   42,   42,   42],
       [   2,   42,   42, ...,   42,   42,   42],
       ...,
       [9997,   42,   42, ...,   42,   42,   42],
       [9998,   42,   42, ...,   42,   42,   42],
       [9999,   42,   42, ...,   42,   42,   42]], dtype=int32)
</pre></div></div>
</div>
<p>##Persistent Arrays</p>
<p>In the examples above, compressed data for each chunk of the array was stored in main memory. Zarr arrays can also be stored on a file system, enabling persistence of data between sessions. For example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z1</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
               <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The array above will store its configuration metadata and all compressed chunk data in a directory called ‘data/example.zarr’ relative to the current working directory. The <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.open()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open</a>&gt;`__ function provides a convenient way to create a new persistent array or continue working with an existing array. Note that although the function is called “open”, there is no need to close an array: data are
automatically flushed to disk, and files are automatically closed whenever an array is modified.</p>
<p>Persistent arrays support the same interface for reading and writing data, e.g.:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z1</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">z1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">z1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Check that the data have been written and can be read again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z2</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">z1</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">z2</span><span class="p">[:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>If you are just looking for a fast and convenient way to save NumPy arrays to disk then load back into memory later, the functions <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.save()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.save">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.save</a>&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.load()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.load">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.load</a>&gt;`__ may be useful. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">zarr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">zarr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</pre></div></div>
</div>
<p>Please note that there are a number of other options for persistent array storage, see the section on <a class="reference external" href="#storage-alternatives">Storage alternatives</a> below.</p>
<p>##Resizing and Appending</p>
<p>A Zarr array can be resized, which means that any of its dimensions can be increased or decreased in length. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">z</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20000, 10000)
</pre></div></div>
</div>
<p>Note that when an array is resized, the underlying data are not rearranged in any way. If one or more dimensions are shrunk, any chunks falling outside the new array shape will be deleted from the underlying store.</p>
<p>For convenience, Zarr arrays also provide an <code class="docutils literal notranslate"><span class="pre">append()</span></code> method, which can be used to append data to any axis. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 1000)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20000, 1000)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20000, 2000)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(20000, 2000)
</pre></div></div>
</div>
<p>##Compressors</p>
<p>A number of different compressors can be used with Zarr. A separate package called <a class="reference external" href="https://numcodecs.readthedocs.io/en/stable/">NumCodecs</a> is available which provides a common interface to various compressor libraries including Blosc, Zstandard, LZ4, Zlib, BZ2 and LZMA. Different compressors can be provided via the <code class="docutils literal notranslate"><span class="pre">compressor</span></code> keyword argument accepted by all array creation functions. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">Blosc</span>
<span class="n">compressor</span> <span class="o">=</span> <span class="n">Blosc</span><span class="p">(</span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;zstd&#39;</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">Blosc</span><span class="o">.</span><span class="n">BITSHUFFLE</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">compressor</span><span class="o">=</span><span class="n">compressor</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">compressor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Blosc(cname=&#39;zstd&#39;, clevel=3, shuffle=BITSHUFFLE, blocksize=0)
</pre></div></div>
</div>
<p>This array above will use Blosc as the primary compressor, using the Zstandard algorithm (compression level 3) internally within Blosc, and with the bit-shuffle filter applied.</p>
<p>When using a compressor, it can be useful to get some diagnostics on the compression ratio. Zarr arrays provide a <code class="docutils literal notranslate"><span class="pre">info</span></code> property which can be used to print some diagnostics, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">int32</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(10000, 10000)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(1000, 1000)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">C</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='zstd', clevel=3, shuffle=BITSHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.KVStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">400000000 (381.5M)</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">3399373 (3.2M)</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">117.7</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">100/100</td></tr></tbody></table></div>
</div>
<p>If you don’t specify a compressor, by default Zarr uses the Blosc compressor. Blosc is generally very fast and can be configured in a variety of ways to improve the compression ratio for different types of data. Blosc is in fact a “meta-compressor”, which means that it can use a number of different compression algorithms internally to compress the data. Blosc also provides highly optimized implementations of byte- and bit-shuffle filters, which can improve compression ratios for some data. A
list of the internal compression libraries available within Blosc can be obtained via:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">blosc</span>
<span class="n">blosc</span><span class="o">.</span><span class="n">list_compressors</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;blosclz&#39;, &#39;lz4&#39;, &#39;lz4hc&#39;, &#39;zlib&#39;, &#39;zstd&#39;]
</pre></div></div>
</div>
<p>In addition to Blosc, other compression libraries can also be used. For example, here is an array using Zstandard compression, level 1:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">Zstd</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
               <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">compressor</span><span class="o">=</span><span class="n">Zstd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">z</span><span class="o">.</span><span class="n">compressor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Zstd(level=1)
</pre></div></div>
</div>
<p>Here is an example using LZMA with a custom filter pipeline including LZMA’s built-in delta filter:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lzma</span>
<span class="n">lzma_filters</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">lzma</span><span class="o">.</span><span class="n">FILTER_DELTA</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">lzma</span><span class="o">.</span><span class="n">FILTER_LZMA2</span><span class="p">,</span> <span class="n">preset</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">LZMA</span>
<span class="n">compressor</span> <span class="o">=</span> <span class="n">LZMA</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">lzma_filters</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
               <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">compressor</span><span class="o">=</span><span class="n">compressor</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">compressor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LZMA(format=1, check=-1, preset=None, filters=[{&#39;dist&#39;: 4, &#39;id&#39;: 3}, {&#39;id&#39;: 33, &#39;preset&#39;: 1}])
</pre></div></div>
</div>
<p>The default compressor can be changed by setting the value of the <code class="docutils literal notranslate"><span class="pre">zarr.storage.default_compressor</span></code> variable, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zarr.storage</span>
<span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">Zstd</span><span class="p">,</span> <span class="n">Blosc</span>

<span class="c1"># Switch to using Zstandard</span>
<span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default_compressor</span> <span class="o">=</span> <span class="n">Zstd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">compressor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Zstd(level=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Switch back to Blosc defaults</span>
<span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default_compressor</span> <span class="o">=</span> <span class="n">Blosc</span><span class="p">()</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">compressor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Blosc(cname=&#39;lz4&#39;, clevel=5, shuffle=SHUFFLE, blocksize=0)
</pre></div></div>
</div>
<p>To disable compression, set <code class="docutils literal notranslate"><span class="pre">compressor=None</span></code> when creating an array, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">compressor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">compressor</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<section id="Filters">
<h1>Filters<a class="headerlink" href="#Filters" title="Permalink to this headline">¶</a></h1>
<p>In some cases, compression can be improved by transforming the data in some way. For example, if nearby values tend to be correlated, then shuffling the bytes within each numerical value or storing the difference between adjacent values may increase compression ratio. Some compressors provide built-in filters that apply transformations to the data prior to compression. For example, the Blosc compressor has built-in implementations of byte- and bit-shuffle filters, and the LZMA compressor has a
built-in implementation of a delta filter. However, to provide additional flexibility for implementing and using filters in combination with different compressors, Zarr also provides a mechanism for configuring filters outside of the primary compressor.</p>
<p>Here is an example using a delta filter with the Blosc compressor:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">Blosc</span><span class="p">,</span> <span class="n">Delta</span>
<span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Delta</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)]</span>
<span class="n">compressor</span> <span class="o">=</span> <span class="n">Blosc</span><span class="p">(</span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;zstd&#39;</span><span class="p">,</span> <span class="n">clevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">Blosc</span><span class="o">.</span><span class="n">SHUFFLE</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">compressor</span><span class="o">=</span><span class="n">compressor</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">int32</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(10000, 10000)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(1000, 1000)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">C</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Filter [0]</th><td style="text-align: left">Delta(dtype='<i4')</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='zstd', clevel=1, shuffle=SHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.KVStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">400000000 (381.5M)</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">1290562 (1.2M)</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">309.9</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">100/100</td></tr></tbody></table></div>
</div>
<p>For more information about available filter codecs, see the <a class="reference external" href="https://numcodecs.readthedocs.io/en/stable/">Numcodecs</a> documentation.</p>
<p>##Groups</p>
<p>Zarr supports hierarchical organization of arrays via groups. As with arrays, groups can be stored in memory, on disk, or via other storage systems that support a similar interface.</p>
<p>To create a group, use the <code class="docutils literal notranslate"><span class="pre">zarr.group()</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">root</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.hierarchy.Group &#39;/&#39;&gt;
</pre></div></div>
</div>
<p>Groups have a similar API to the Group class from <a class="reference external" href="https://www.h5py.org/">h5py</a>. For example, groups can contain other groups:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">bar</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Groups can also contain arrays, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z1</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array &#39;/foo/bar/baz&#39; (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>Arrays are known as “datasets” in HDF5 terminology. For compatibility with h5py, Zarr groups also implement the <code class="docutils literal notranslate"><span class="pre">create_dataset()</span></code> and <code class="docutils literal notranslate"><span class="pre">require_dataset()</span></code> methods, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;quux&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array &#39;/foo/bar/quux&#39; (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>Members of a group can be accessed via the suffix notation, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.hierarchy.Group &#39;/foo&#39;&gt;
</pre></div></div>
</div>
<p>The ‘/’ character can be used to access multiple levels of the hierarchy in one call, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">[</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.hierarchy.Group &#39;/foo/bar&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">[</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array &#39;/foo/bar/baz&#39; (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">`zarr.hierarchy.Group.tree()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/hierarchy.html#zarr.hierarchy.Group.tree">https://zarr.readthedocs.io/en/stable/api/hierarchy.html#zarr.hierarchy.Group.tree</a>&gt;`__ method can be used to print a tree representation of the hierarchy, e.g.:</p>
<p>Input:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root.tree()
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 └── foo
     └── bar
         ├── baz (10000, 10000) int32
         └── quux (10000, 10000) int32
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.open()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open</a>&gt;`__ function provides a convenient way to create or re-open a group stored in a directory on the file-system, with sub-groups stored in sub-directories, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/group.zarr&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">root</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.hierarchy.Group &#39;/&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array &#39;/foo/bar/baz&#39; (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>Groups can be used as context managers (in a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement). If the underlying store has a <code class="docutils literal notranslate"><span class="pre">close</span></code> method, it will be called on exit.</p>
<p>For more information on groups see the <code class="docutils literal notranslate"><span class="pre">`zarr.hierarchy</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/hierarchy.html#module-zarr.hierarchy">https://zarr.readthedocs.io/en/stable/api/hierarchy.html#module-zarr.hierarchy</a>&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`zarr.convenience</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#module-zarr.convenience">https://zarr.readthedocs.io/en/stable/api/convenience.html#module-zarr.convenience</a>&gt;`__ API docs</p>
<p>##Array and Group Diagnostics Diagnostic information about arrays and groups is available via the info property. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">bar</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i8&#39;</span><span class="p">)</span>
<span class="n">bar</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">baz</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f4&#39;</span><span class="p">)</span>
<span class="n">baz</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">4.2</span>
<span class="n">root</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Name</th><td style="text-align: left">/</td></tr><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.hierarchy.Group</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.MemoryStore</td></tr><tr><th style="text-align: left">No. members</th><td style="text-align: left">1</td></tr><tr><th style="text-align: left">No. arrays</th><td style="text-align: left">0</td></tr><tr><th style="text-align: left">No. groups</th><td style="text-align: left">1</td></tr><tr><th style="text-align: left">Groups</th><td style="text-align: left">foo</td></tr></tbody></table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Name</th><td style="text-align: left">/foo</td></tr><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.hierarchy.Group</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.MemoryStore</td></tr><tr><th style="text-align: left">No. members</th><td style="text-align: left">2</td></tr><tr><th style="text-align: left">No. arrays</th><td style="text-align: left">2</td></tr><tr><th style="text-align: left">No. groups</th><td style="text-align: left">0</td></tr><tr><th style="text-align: left">Arrays</th><td style="text-align: left">bar, baz</td></tr></tbody></table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bar</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Name</th><td style="text-align: left">/foo/bar</td></tr><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">int64</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(1000000,)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(100000,)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">C</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='lz4', clevel=5, shuffle=SHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.MemoryStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">8000000 (7.6M)</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">33080 (32.3K)</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">241.8</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">10/10</td></tr></tbody></table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baz</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Name</th><td style="text-align: left">/foo/baz</td></tr><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">float32</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(1000, 1000)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(100, 100)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">C</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='lz4', clevel=5, shuffle=SHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.MemoryStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">4000000 (3.8M)</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">23943 (23.4K)</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">167.1</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">100/100</td></tr></tbody></table></div>
</div>
<p>Groups also have the <code class="docutils literal notranslate"><span class="pre">`zarr.hierarchy.Group.tree()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/hierarchy.html#zarr.hierarchy.Group.tree">https://zarr.readthedocs.io/en/stable/api/hierarchy.html#zarr.hierarchy.Group.tree</a>&gt;`__ method, e.g.:</p>
<p>Input:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root.tree()
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 └── foo
     ├── bar (1000000,) int64
     └── baz (1000, 1000) float32
</pre></div>
</div>
<p>If you’re using Zarr within a Jupyter notebook (requires <a class="reference external" href="https://github.com/QuantStack/ipytree">ipytree</a>, calling <code class="docutils literal notranslate"><span class="pre">tree()</span></code> will generate an interactive tree representation, see the <a class="reference external" href="https://nbviewer.org/github/zarr-developers/zarr-python/blob/master/notebooks/repr_tree.ipynb">repr_tree.ipynb notebook</a> for more examples.</p>
<p>##User Attributes</p>
<p>Zarr arrays and groups support custom key/value attributes, which can be useful for storing application-specific metadata. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;zzz&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
<span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;qux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;foo&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;bar&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;baz&#39;, &#39;qux&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
42
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;qux&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1, 4, 7, 12]
</pre></div></div>
</div>
<p>Internally Zarr uses JSON to store array attributes, so attribute values must be JSON serializable.</p>
<p>##Advanced Indexing As of version 2.2, Zarr arrays support several methods for advanced or “fancy” indexing, which enable a subset of data items to be extracted or updated in an array without loading the entire array into memory.</p>
<p>Note that although this functionality is similar to some of the advanced indexing capabilities available on NumPy arrays and on h5py datasets, <strong>the Zarr API for advanced indexing is different from both NumPy and h5py</strong>, so please read this section carefully. For a complete description of the indexing API, see the documentation for the <code class="docutils literal notranslate"><span class="pre">`zarr.core.Array</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/core.html#zarr.core.Array">https://zarr.readthedocs.io/en/stable/api/core.html#zarr.core.Array</a>&gt;`__ class.</p>
<p>###Indexing with Coordinate Arrays Items from a Zarr array can be extracted by providing an integer array of coordinates. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">get_coordinate_selection</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1, 4])
</pre></div></div>
</div>
<p>Coordinate arrays can also be used to update data, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">set_coordinate_selection</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 0, -1,  2,  3, -2,  5,  6,  7,  8,  9])
</pre></div></div>
</div>
<p>For multidimensional arrays, coordinates must be provided for each dimension, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">get_coordinate_selection</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 1, 13])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">set_coordinate_selection</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0, -1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, -2, 14]])
</pre></div></div>
</div>
<p>For convenience, coordinate indexing is also available via the <code class="docutils literal notranslate"><span class="pre">vindex</span></code> property, as well as the square bracket operator, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">vindex</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-1, -2])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">vindex</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0, -3,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, -4, 14]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-3, -4])
</pre></div></div>
</div>
<p>When the indexing arrays have different shapes, they are broadcast together. That is, the following two calls are equivalent:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([6, 8])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([6, 8])
</pre></div></div>
</div>
<p>###Indexing with Mask Array Items can also be extracted by providing a Boolean mask. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">sel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sel</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">z</span><span class="o">.</span><span class="n">get_mask_selection</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1, 4])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">set_mask_selection</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 0, -1,  2,  3, -2,  5,  6,  7,  8,  9])
</pre></div></div>
</div>
<p>Here’s a multidimensional example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">z</span><span class="o">.</span><span class="n">get_mask_selection</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 1, 13])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">set_mask_selection</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0, -1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, -2, 14]])
</pre></div></div>
</div>
<p>For convenience, mask indexing is also available via the <code class="docutils literal notranslate"><span class="pre">vindex</span></code> property, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">vindex</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-1, -2])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">vindex</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0, -3,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, -4, 14]])
</pre></div></div>
</div>
<p>Mask indexing is conceptually the same as coordinate indexing, and is implemented internally via the same machinery. Both styles of indexing allow selecting arbitrary items from an array, also known as point selection.</p>
<p>###Orthogonal Indexing Zarr arrays also support methods for orthogonal indexing, which allows selections to be made along each dimension of an array independently. For example, this allows selecting a subset of rows and/or columns from a 2-dimensional array. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select First and Third Rows</span>
<span class="n">z</span><span class="o">.</span><span class="n">get_orthogonal_selection</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0,  1,  2,  3,  4],
       [10, 11, 12, 13, 14]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select Second and Fourth Columns</span>
<span class="n">z</span><span class="o">.</span><span class="n">get_orthogonal_selection</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1,  3],
       [ 6,  8],
       [11, 13]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select Rows [0, 2] and Columns [1, 4]</span>
<span class="n">z</span><span class="o">.</span><span class="n">get_orthogonal_selection</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1,  3],
       [11, 13]])
</pre></div></div>
</div>
<p>Data can also be modified, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">set_orthogonal_selection</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0, -1,  2, -2,  4],
       [ 5,  6,  7,  8,  9],
       [10, -3, 12, -4, 14]])
</pre></div></div>
</div>
<p>For convenience, the orthogonal indexing functionality is also available via the <code class="docutils literal notranslate"><span class="pre">oindex</span></code> property, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Select First and Third Rows</span>
<span class="n">z</span><span class="o">.</span><span class="n">oindex</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0,  1,  2,  3,  4],
       [10, 11, 12, 13, 14]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select Second and Fourth Columns</span>
<span class="n">z</span><span class="o">.</span><span class="n">oindex</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1,  3],
       [ 6,  8],
       [11, 13]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select Rows [0, 2] and Columns [1, 4]</span>
<span class="n">z</span><span class="o">.</span><span class="n">oindex</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1,  3],
       [11, 13]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">oindex</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]]</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0, -1,  2, -2,  4],
       [ 5,  6,  7,  8,  9],
       [10, -3, 12, -4, 14]])
</pre></div></div>
</div>
<p>Any combination of integer, slice, 1D integer array and/or 1D Boolean array can be used for orthogonal indexing.</p>
<p>###Indexing Fields in Structured Arrays All selection methods support a <code class="docutils literal notranslate"><span class="pre">fields</span></code> parameter which allows retrieving or replacing data for a specific field in an array with a structured dtype. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="sa">b</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">),</span>
              <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">8.4</span><span class="p">),</span>
              <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;ccc&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">12.6</span><span class="p">)],</span>
             <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;S3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">)])</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">z</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([b&#39;aaa&#39;, b&#39;bbb&#39;, b&#39;ccc&#39;], dtype=&#39;|S3&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 4.2,  8.4, 12.6])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">get_basic_selection</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fields</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1, 2], dtype=int32)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">get_coordinate_selection</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([(b&#39;aaa&#39;,  4.2), (b&#39;ccc&#39;, 12.6)],
      dtype=[(&#39;foo&#39;, &#39;S3&#39;), (&#39;baz&#39;, &#39;&lt;f8&#39;)])
</pre></div></div>
</div>
<p>##Storage Alternatives</p>
<p>Zarr can use any object that implements the <code class="docutils literal notranslate"><span class="pre">MutableMapping</span></code> interface from the <code class="docutils literal notranslate"><span class="pre">`collections</span></code> &lt;<a class="reference external" href="https://docs.python.org/3/library/collections.html#module-collections">https://docs.python.org/3/library/collections.html#module-collections</a>&gt;`__ module in the Python standard library as the store for a group or an array.</p>
<p>Some pre-defined storage classes are provided in the <code class="docutils literal notranslate"><span class="pre">`zarr.storage</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#module-zarr.storage">https://zarr.readthedocs.io/en/stable/api/storage.html#module-zarr.storage</a>&gt;`__ module. For example, the <code class="docutils literal notranslate"><span class="pre">`zarr.storage.DirectoryStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DirectoryStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DirectoryStore</a>&gt;`__ class provides a <code class="docutils literal notranslate"><span class="pre">MutableMapping</span></code> interface to a directory on the local file system. This is used under the hood by the
<code class="docutils literal notranslate"><span class="pre">`zarr.convenience.open()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open</a>&gt;`__ function. In other words, the following code:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>…is short-hand for:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">DirectoryStore</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>…and the following code:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>…is short-hand for:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">DirectoryStore</span><span class="p">(</span><span class="s1">&#39;data/example.zarr&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Any other compatible storage class could be used in place of <code class="docutils literal notranslate"><span class="pre">`zarr.storage.DirectoryStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DirectoryStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DirectoryStore</a>&gt;`__ in the code examples above. For example, here is an array stored directly into a Zip file, via the <code class="docutils literal notranslate"><span class="pre">`zarr.storage.ZipStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ZipStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ZipStore</a>&gt;`__ class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">ZipStore</span><span class="p">(</span><span class="s1">&#39;data/example.zip&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Re-open and check that data have been written:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">ZipStore</span><span class="p">(</span><span class="s1">&#39;data/example.zip&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">]</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[42, 42, 42, ..., 42, 42, 42],
       [42, 42, 42, ..., 42, 42, 42],
       [42, 42, 42, ..., 42, 42, 42],
       ...,
       [42, 42, 42, ..., 42, 42, 42],
       [42, 42, 42, ..., 42, 42, 42],
       [42, 42, 42, ..., 42, 42, 42]], dtype=int32)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Note that there are some limitations on how Zip files can be used, because items within a Zip file cannot be updated in place. This means that data in the array should only be written once and write operations should be aligned with chunk boundaries. Note also that the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method must be called after writing any data to the store, otherwise essential records will not be written to the underlying zip file.</p>
<p>Another storage alternative is the <code class="docutils literal notranslate"><span class="pre">`zarr.storage.DBMStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DBMStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DBMStore</a>&gt;`__ class, added in Zarr version 2.2. This class allows any DBM-style database to be used for storing an array or group. Here is an example using a Berkeley DB B-tree database for storage (requires <a class="reference external" href="https://www.jcea.es/programacion/pybsddb.htm">bsddb3</a> to be installed):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import bsddb3
store = zarr.DBMStore(&#39;data/example.bdb&#39;, open=bsddb3.btopen)
root = zarr.group(store=store, overwrite=True)
z = root.zeros(&#39;foo/bar&#39;, shape=(1000, 1000), chunks=(100, 100), dtype=&#39;i4&#39;)
z[:] = 42
store.close()
</pre></div>
</div>
<p>Also added in Zarr version 2.2 is the <code class="docutils literal notranslate"><span class="pre">`zarr.storage.LMDBStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.LMDBStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.LMDBStore</a>&gt;`__ class which enables the lightning memory-mapped database (LMDB) to be used for storing an array or group (requires lmdb to be installed):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">LMDBStore</span><span class="p">(</span><span class="s1">&#39;data/example.lmdb&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
Input <span class="ansi-green-fg">In [87]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> store <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">LMDBStore</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">data/example.lmdb</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> root <span style="color: rgb(98,98,98)">=</span> zarr<span style="color: rgb(98,98,98)">.</span>group(store<span style="color: rgb(98,98,98)">=</span>store, overwrite<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-intense-fg ansi-bold">      3</span> z <span style="color: rgb(98,98,98)">=</span> root<span style="color: rgb(98,98,98)">.</span>zeros(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">foo/bar</span><span style="color: rgb(175,0,0)">&#39;</span>, shape<span style="color: rgb(98,98,98)">=</span>(<span style="color: rgb(98,98,98)">1000</span>, <span style="color: rgb(98,98,98)">1000</span>), chunks<span style="color: rgb(98,98,98)">=</span>(<span style="color: rgb(98,98,98)">100</span>, <span style="color: rgb(98,98,98)">100</span>), dtype<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">i4</span><span style="color: rgb(175,0,0)">&#39;</span>)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:2163</span>, in <span class="ansi-cyan-fg">LMDBStore.__init__</span><span class="ansi-blue-fg">(self, path, buffers, dimension_separator, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   2162</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">__init__</span>(<span style="color: rgb(0,135,0)">self</span>, path, buffers<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>, dimension_separator<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">None</span>, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-fg">-&gt; 2163</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">lmdb</span>
<span class="ansi-green-intense-fg ansi-bold">   2165</span>     <span style="color: rgb(95,135,135)"># set default memory map size to something larger than the lmdb default, which is</span>
<span class="ansi-green-intense-fg ansi-bold">   2166</span>     <span style="color: rgb(95,135,135)"># very likely to be too small for any moderate array (logic copied from zict)</span>
<span class="ansi-green-intense-fg ansi-bold">   2167</span>     map_size <span style="color: rgb(98,98,98)">=</span> (<span style="color: rgb(98,98,98)">2</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">40</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> sys<span style="color: rgb(98,98,98)">.</span>maxsize <span style="color: rgb(98,98,98)">&gt;</span><span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">2</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">32</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span> <span style="color: rgb(98,98,98)">2</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">28</span>)

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;lmdb&#39;
</pre></div></div>
</div>
<p>In Zarr version 2.3 is the <code class="docutils literal notranslate"><span class="pre">`zarr.storage.SQLiteStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.SQLiteStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.SQLiteStore</a>&gt;`__ class which enables the SQLite database to be used for storing an array or group (requires Python is built with SQLite support):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">SQLiteStore</span><span class="p">(</span><span class="s1">&#39;data/example.sqldb&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Also added in Zarr version 2.3 are two storage classes for interfacing with server-client databases. The <code class="docutils literal notranslate"><span class="pre">`zarr.storage.RedisStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.RedisStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.RedisStore</a>&gt;`__ class interfaces <a class="reference external" href="https://redis.io/">Redis</a> (an in memory data structure store), and the <code class="docutils literal notranslate"><span class="pre">zarr.storage.MongoDB</span></code> class interfaces with <a class="reference external" href="https://www.mongodb.com/">MongoDB</a> (an object oriented NoSQL database). These stores respectively require the
<a class="reference external" href="https://redis-py.readthedocs.io/en/stable/">redis-py</a> and <a class="reference external" href="https://api.mongodb.com/python/current/">pymongo</a> packages to be installed.</p>
<p>For compatibility with the <a class="reference external" href="https://github.com/saalfeldlab/n5">N5</a> data format, Zarr also provides an N5 backend (this is currently an experimental feature). Similar to the zip storage class, an <code class="docutils literal notranslate"><span class="pre">`zarr.n5.N5Store</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/n5.html#zarr.n5.N5Store">https://zarr.readthedocs.io/en/stable/api/n5.html#zarr.n5.N5Store</a>&gt;`__ can be instantiated directly:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">N5Store</span><span class="p">(</span><span class="s1">&#39;data/example.n5&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/gbotemi/.local/lib/python3.10/site-packages/zarr/n5.py:738: RuntimeWarning: Not all N5 implementations support blosc compression (yet). You might not be able to open the dataset with another N5 library.
  warnings.warn(
</pre></div></div>
</div>
<p>For convenience, the N5 backend will automatically be chosen when the filename ends with <em>.n5</em>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/example.n5&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>###Distributed/Cloud Storage</p>
<p>It is also possible to use distributed storage systems. The Dask project has implementations of the <code class="docutils literal notranslate"><span class="pre">MutableMapping</span></code> interface for Amazon S3 (<a class="reference external" href="https://s3fs.readthedocs.io/en/latest/api.html#s3fs.mapping.S3Map">S3Map</a>), Hadoop Distributed File System (<a class="reference external" href="https://hdfs3.readthedocs.io/en/latest/api.html#hdfs3.mapping.HDFSMap">HDFSMap</a>) and Google Cloud Storage (<a class="reference external" href="https://gcsfs.readthedocs.io/en/latest/api.html#gcsfs.mapping.GCSMap">GCSMap</a>), which can be used with Zarr.</p>
<p>Here is an example using S3Map to read an array created previously:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">s3fs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Defaulting to user installation because normal site-packages is not writeable
Collecting s3fs
  Using cached s3fs-2022.8.2-py3-none-any.whl (27 kB)
Collecting fsspec==2022.8.2
  Using cached fsspec-2022.8.2-py3-none-any.whl (140 kB)
Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /home/gbotemi/.local/lib/python3.10/site-packages (from s3fs) (3.8.1)
Collecting aiobotocore~=2.4.0
  Using cached aiobotocore-2.4.0-py3-none-any.whl (65 kB)
Collecting botocore&lt;1.27.60,&gt;=1.27.59
  Downloading botocore-1.27.59-py3-none-any.whl (9.1 MB)
     <span style="color: rgb(114,156,31)">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span class="ansi-green-fg">9.1/9.1 MB</span> <span class="ansi-red-fg">136.5 kB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>
Collecting aioitertools&gt;=0.5.1
  Using cached aioitertools-0.11.0-py3-none-any.whl (23 kB)
Collecting wrapt&gt;=1.10.10
  Using cached wrapt-1.14.1-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (77 kB)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (1.3.1)
Requirement already satisfied: attrs&gt;=17.3.0 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (22.1.0)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (6.0.2)
Requirement already satisfied: charset-normalizer&lt;3.0,&gt;=2.0 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (2.1.1)
Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0.0a3 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (4.0.2)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.0 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (1.8.1)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /home/gbotemi/.local/lib/python3.10/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (1.2.0)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.25.4 in /usr/lib/python3/dist-packages (from botocore&lt;1.27.60,&gt;=1.27.59-&gt;aiobotocore~=2.4.0-&gt;s3fs) (1.26.5)
Collecting jmespath&lt;2.0.0,&gt;=0.7.1
  Downloading jmespath-1.0.1-py3-none-any.whl (20 kB)
Requirement already satisfied: python-dateutil&lt;3.0.0,&gt;=2.1 in /home/gbotemi/.local/lib/python3.10/site-packages (from botocore&lt;1.27.60,&gt;=1.27.59-&gt;aiobotocore~=2.4.0-&gt;s3fs) (2.8.2)
Requirement already satisfied: idna&gt;=2.0 in /usr/lib/python3/dist-packages (from yarl&lt;2.0,&gt;=1.0-&gt;aiohttp!=4.0.0a0,!=4.0.0a1-&gt;s3fs) (3.3)
Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&lt;3.0.0,&gt;=2.1-&gt;botocore&lt;1.27.60,&gt;=1.27.59-&gt;aiobotocore~=2.4.0-&gt;s3fs) (1.16.0)
Installing collected packages: wrapt, jmespath, fsspec, aioitertools, botocore, aiobotocore, s3fs
  Attempting uninstall: fsspec
    Found existing installation: fsspec 2022.7.1
    Uninstalling fsspec-2022.7.1:
      Successfully uninstalled fsspec-2022.7.1
Successfully installed aiobotocore-2.4.0 aioitertools-0.11.0 botocore-1.27.59 fsspec-2022.8.2 jmespath-1.0.1 s3fs-2022.8.2 wrapt-1.14.1
Note: you may need to restart the kernel to use updated packages.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">s3fs</span>
<span class="kn">import</span> <span class="nn">zarr</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">client_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;eu-west-2&#39;</span><span class="p">))</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3Map</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;zarr-demo/store&#39;</span><span class="p">,</span> <span class="n">s3</span><span class="o">=</span><span class="n">s3</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">]</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array &#39;/foo/bar/baz&#39; (21,) |S1&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Name</th><td style="text-align: left">/foo/bar/baz</td></tr><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">|S1</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(21,)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(7,)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">C</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='lz4', clevel=5, shuffle=SHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.KVStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">21</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">382</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">0.1</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">3/3</td></tr></tbody></table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([b&#39;H&#39;, b&#39;e&#39;, b&#39;l&#39;, b&#39;l&#39;, b&#39;o&#39;, b&#39; &#39;, b&#39;f&#39;, b&#39;r&#39;, b&#39;o&#39;, b&#39;m&#39;, b&#39; &#39;,
       b&#39;t&#39;, b&#39;h&#39;, b&#39;e&#39;, b&#39; &#39;, b&#39;c&#39;, b&#39;l&#39;, b&#39;o&#39;, b&#39;u&#39;, b&#39;d&#39;, b&#39;!&#39;],
      dtype=&#39;|S1&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;Hello from the cloud!&#39;
</pre></div></div>
</div>
<p>Zarr now also has a builtin storage backend for Azure Blob Storage. The class is <code class="docutils literal notranslate"><span class="pre">`zarr.storage.ABSStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ABSStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ABSStore</a>&gt;`__ (requires <a class="reference external" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-quickstart-blobs-python?tabs=environment-variable-windows">azure-storage-blob</a> to be installed):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import azure.storage.blob
container_client = azure.storage.blob.ContainerClient(...)
store = zarr.ABSStore(client=container_client, prefix=&#39;zarr-testing&#39;)
root = zarr.group(store=store, overwrite=True)
z = root.zeros(&#39;foo/bar&#39;, shape=(1000, 1000), chunks=(100, 100), dtype=&#39;i4&#39;)
z[:] = 42
</pre></div>
</div>
<p>When using an actual storage account, provide <code class="docutils literal notranslate"><span class="pre">account_name</span></code> and <code class="docutils literal notranslate"><span class="pre">account_key</span></code> arguments to <code class="docutils literal notranslate"><span class="pre">`zarr.storage.ABSStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ABSStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ABSStore</a>&gt;`__, the above client is just testing against the emulator. Please also note that this is an experimental feature.</p>
<p>Note that retrieving data from a remote service via the network can be significantly slower than retrieving data from a local file system, and will depend on network latency and bandwidth between the client and server systems. If you are experiencing poor performance, there are several things you can try. One option is to increase the array chunk size, which will reduce the number of chunks and thus reduce the number of network round-trips required to retrieve data for an array (and thus reduce
the impact of network latency). Another option is to try to increase the compression ratio by changing compression options or trying a different compressor (which will reduce the impact of limited network bandwidth).</p>
<p>As of version 2.2, Zarr also provides the <code class="docutils literal notranslate"><span class="pre">`zarr.storage.LRUStoreCache</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.LRUStoreCache">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.LRUStoreCache</a>&gt;`__ which can be used to implement a local in-memory cache layer over a remote store. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">client_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;eu-west-2&#39;</span><span class="p">))</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3Map</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;zarr-demo/store&#39;</span><span class="p">,</span> <span class="n">s3</span><span class="o">=</span><span class="n">s3</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">LRUStoreCache</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">28</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">timeit</span>
<span class="c1"># First data access is relatively slow, retrieved from store</span>
<span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;print(z[:].tobytes())&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;Hello from the cloud!&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9068896710014087
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Second data access is faster, uses cache</span>
<span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;print(z[:].tobytes())&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;Hello from the cloud!&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0024232529976870865
</pre></div></div>
</div>
<p>If you are still experiencing poor performance with distributed/cloud storage, please raise an issue on the GitHub issue tracker with any profiling data you can provide, as there may be opportunities to optimise further either within Zarr or within the mapping interface to the storage.</p>
<p>###IO with <code class="docutils literal notranslate"><span class="pre">fsspec</span></code></p>
<p>As of version 2.5, zarr supports passing URLs directly to <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/">fsspec</a>, and having it create the “mapping” instance automatically. This means, that for all of the backend storage implementations <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/api.html#built-in-implementations">supported by fsspec</a>, you can skip importing and configuring the storage explicitly. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="s2">&quot;s3://zarr-demo/store&quot;</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="n">g</span><span class="p">[</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;Hello from the cloud!&#39;
</pre></div></div>
</div>
<p>The provision of the protocol specifier “s3://” will select the correct backend. Notice the kwargs <code class="docutils literal notranslate"><span class="pre">storage_options</span></code>, used to pass parameters to that backend.</p>
<p>As of version 2.6, write mode and complex URLs are also supported, such as</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="s2">&quot;simplecache::s3://zarr-demo/store&quot;</span><span class="p">,</span>
                    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[100]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Downloads Target File</span>
<span class="n">g</span><span class="p">[</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[100]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;Hello from the cloud!&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uses Cached File</span>
<span class="n">g</span><span class="p">[</span><span class="s1">&#39;foo/bar/baz&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;Hello from the cloud!&#39;
</pre></div></div>
</div>
<p>The second invocation here will be much faster. Note that the <code class="docutils literal notranslate"><span class="pre">storage_options</span></code> have become more complex here, to account for the two parts of the supplied URL.</p>
<p>###Consolidating Metadata</p>
<p>Since there is a significant overhead for every connection to a cloud object store such as S3, the pattern described in the previous section may incur significant latency while scanning the metadata of the array hierarchy, even though each individual metadata object is small. For cases such as these, once the data are static and can be regarded as read-only, at least for the metadata/structure of the array hierarchy, the many metadata objects can be consolidated into a single one via
<code class="docutils literal notranslate"><span class="pre">`zarr.convenience.consolidate_metadata()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.consolidate_metadata">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.consolidate_metadata</a>&gt;`__. Doing this can greatly increase the speed of reading the array metadata, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zarr</span><span class="o">.</span><span class="n">consolidate_metadata</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ClientError</span>                               Traceback (most recent call last)
File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:110</span>, in <span class="ansi-cyan-fg">_error_wrapper</span><span class="ansi-blue-fg">(func, args, kwargs, retries)</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 110</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> func(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-intense-fg ansi-bold">    111</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> S3_RETRYABLE_ERRORS <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/aiobotocore/client.py:358</span>, in <span class="ansi-cyan-fg">AioBaseClient._make_api_call</span><span class="ansi-blue-fg">(self, operation_name, api_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    357</span>     error_class <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>exceptions<span style="color: rgb(98,98,98)">.</span>from_code(error_code)
<span class="ansi-green-fg">--&gt; 358</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> error_class(parsed_response, operation_name)
<span class="ansi-green-intense-fg ansi-bold">    359</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:

<span class="ansi-red-fg">ClientError</span>: An error occurred (AccessDenied) when calling the PutObject operation: Access Denied

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">PermissionError</span>                           Traceback (most recent call last)
Input <span class="ansi-green-fg">In [102]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">consolidate_metadata</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/convenience.py:1235</span>, in <span class="ansi-cyan-fg">consolidate_metadata</span><span class="ansi-blue-fg">(store, metadata_key, path)</span>
<span class="ansi-green-intense-fg ansi-bold">   1226</span>     <span style="color: rgb(95,135,135)"># path = &#39;consolidated&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">   1228</span> out <span style="color: rgb(98,98,98)">=</span> {
<span class="ansi-green-intense-fg ansi-bold">   1229</span>     <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">zarr_consolidated_format</span><span style="color: rgb(175,0,0)">&#39;</span>: <span style="color: rgb(98,98,98)">1</span>,
<span class="ansi-green-intense-fg ansi-bold">   1230</span>     <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">metadata</span><span style="color: rgb(175,0,0)">&#39;</span>: {
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">   1233</span>     }
<span class="ansi-green-intense-fg ansi-bold">   1234</span> }
<span class="ansi-green-fg">-&gt; 1235</span> <span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">metadata_key</span><span class="ansi-yellow-bg">]</span> <span style="color: rgb(98,98,98)">=</span> json_dumps(out)
<span class="ansi-green-intense-fg ansi-bold">   1236</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> open_consolidated(store, metadata_key<span style="color: rgb(98,98,98)">=</span>metadata_key, path<span style="color: rgb(98,98,98)">=</span>path)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:727</span>, in <span class="ansi-cyan-fg">KVStore.__setitem__</span><span class="ansi-blue-fg">(self, key, value)</span>
<span class="ansi-green-intense-fg ansi-bold">    726</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">__setitem__</span>(<span style="color: rgb(0,135,0)">self</span>, key, value):
<span class="ansi-green-fg">--&gt; 727</span>     <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_mutable_mapping</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">]</span> <span style="color: rgb(98,98,98)">=</span> value

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/mapping.py:156</span>, in <span class="ansi-cyan-fg">FSMap.__setitem__</span><span class="ansi-blue-fg">(self, key, value)</span>
<span class="ansi-green-intense-fg ansi-bold">    154</span> key <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_key_to_str(key)
<span class="ansi-green-intense-fg ansi-bold">    155</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>fs<span style="color: rgb(98,98,98)">.</span>mkdirs(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>fs<span style="color: rgb(98,98,98)">.</span>_parent(key), exist_ok<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">--&gt; 156</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fs</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">pipe_file</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">maybe_convert</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">value</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:111</span>, in <span class="ansi-cyan-fg">sync_wrapper.&lt;locals&gt;.wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span> <span style="color: rgb(175,0,255)">@functools</span><span style="color: rgb(98,98,98)">.</span>wraps(func)
<span class="ansi-green-intense-fg ansi-bold">    109</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">wrapper</span>(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-intense-fg ansi-bold">    110</span>     <span style="color: rgb(0,135,0)">self</span> <span style="color: rgb(98,98,98)">=</span> obj <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> args[<span style="color: rgb(98,98,98)">0</span>]
<span class="ansi-green-fg">--&gt; 111</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">loop</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:96</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(loop, func, timeout, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     94</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> FSTimeoutError <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">return_result</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">isinstance</span>(return_result, <span class="ansi-bold" style="color: rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">---&gt; 96</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-intense-fg ansi-bold">     97</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">     98</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> return_result

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:53</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(event, coro, result, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>     coro <span style="color: rgb(98,98,98)">=</span> asyncio<span style="color: rgb(98,98,98)">.</span>wait_for(coro, timeout<span style="color: rgb(98,98,98)">=</span>timeout)
<span class="ansi-green-intense-fg ansi-bold">     52</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">---&gt; 53</span>     result[<span style="color: rgb(98,98,98)">0</span>] <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> coro
<span class="ansi-green-intense-fg ansi-bold">     54</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> ex:
<span class="ansi-green-intense-fg ansi-bold">     55</span>     result[<span style="color: rgb(98,98,98)">0</span>] <span style="color: rgb(98,98,98)">=</span> ex

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:962</span>, in <span class="ansi-cyan-fg">S3FileSystem._pipe_file</span><span class="ansi-blue-fg">(self, path, data, chunksize, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    960</span> <span style="color: rgb(95,135,135)"># 5 GB is the limit for an S3 PUT</span>
<span class="ansi-green-intense-fg ansi-bold">    961</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> size <span style="color: rgb(98,98,98)">&lt;</span> <span style="color: rgb(0,135,0)">min</span>(<span style="color: rgb(98,98,98)">5</span> <span style="color: rgb(98,98,98)">*</span> <span style="color: rgb(98,98,98)">2</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">30</span>, <span style="color: rgb(98,98,98)">2</span> <span style="color: rgb(98,98,98)">*</span> chunksize):
<span class="ansi-green-fg">--&gt; 962</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_call_s3(
<span class="ansi-green-intense-fg ansi-bold">    963</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">put_object</span><span style="color: rgb(175,0,0)">&#34;</span>, Bucket<span style="color: rgb(98,98,98)">=</span>bucket, Key<span style="color: rgb(98,98,98)">=</span>key, Body<span style="color: rgb(98,98,98)">=</span>data, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs
<span class="ansi-green-intense-fg ansi-bold">    964</span>     )
<span class="ansi-green-intense-fg ansi-bold">    965</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    967</span>     mpu <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_call_s3(
<span class="ansi-green-intense-fg ansi-bold">    968</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">create_multipart_upload</span><span style="color: rgb(175,0,0)">&#34;</span>, Bucket<span style="color: rgb(98,98,98)">=</span>bucket, Key<span style="color: rgb(98,98,98)">=</span>key, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs
<span class="ansi-green-intense-fg ansi-bold">    969</span>     )

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:332</span>, in <span class="ansi-cyan-fg">S3FileSystem._call_s3</span><span class="ansi-blue-fg">(self, method, *akwarglist, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    330</span> logger<span style="color: rgb(98,98,98)">.</span>debug(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">CALL: </span><span class="ansi-bold" style="color: rgb(175,95,135)">%s</span><span style="color: rgb(175,0,0)"> - </span><span class="ansi-bold" style="color: rgb(175,95,135)">%s</span><span style="color: rgb(175,0,0)"> - </span><span class="ansi-bold" style="color: rgb(175,95,135)">%s</span><span style="color: rgb(175,0,0)">&#34;</span>, method<span style="color: rgb(98,98,98)">.</span><span style="color: rgb(0,0,135)">__name__</span>, akwarglist, kw2)
<span class="ansi-green-intense-fg ansi-bold">    331</span> additional_kwargs <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_get_s3_method_kwargs(method, <span style="color: rgb(98,98,98)">*</span>akwarglist, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">--&gt; 332</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> _error_wrapper(
<span class="ansi-green-intense-fg ansi-bold">    333</span>     method, kwargs<span style="color: rgb(98,98,98)">=</span>additional_kwargs, retries<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>retries
<span class="ansi-green-intense-fg ansi-bold">    334</span> )

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:137</span>, in <span class="ansi-cyan-fg">_error_wrapper</span><span class="ansi-blue-fg">(func, args, kwargs, retries)</span>
<span class="ansi-green-intense-fg ansi-bold">    135</span>         err <span style="color: rgb(98,98,98)">=</span> e
<span class="ansi-green-intense-fg ansi-bold">    136</span> err <span style="color: rgb(98,98,98)">=</span> translate_boto_error(err)
<span class="ansi-green-fg">--&gt; 137</span> <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> err

<span class="ansi-red-fg">PermissionError</span>: Access Denied
</pre></div></div>
</div>
<p>This creates a special key with a copy of all of the metadata from all of the metadata objects in the store.</p>
<p>Later, to open a Zarr store with consolidated metadata, use <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.open_consolidated()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open_consolidated">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open_consolidated</a>&gt;`__, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_consolidated</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NoSuchKey</span>                                 Traceback (most recent call last)
File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:110</span>, in <span class="ansi-cyan-fg">_error_wrapper</span><span class="ansi-blue-fg">(func, args, kwargs, retries)</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 110</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> func(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-intense-fg ansi-bold">    111</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> S3_RETRYABLE_ERRORS <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/aiobotocore/client.py:358</span>, in <span class="ansi-cyan-fg">AioBaseClient._make_api_call</span><span class="ansi-blue-fg">(self, operation_name, api_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    357</span>     error_class <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>exceptions<span style="color: rgb(98,98,98)">.</span>from_code(error_code)
<span class="ansi-green-fg">--&gt; 358</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> error_class(parsed_response, operation_name)
<span class="ansi-green-intense-fg ansi-bold">    359</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:

<span class="ansi-red-fg">NoSuchKey</span>: An error occurred (NoSuchKey) when calling the GetObject operation: The specified key does not exist.

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/mapping.py:137</span>, in <span class="ansi-cyan-fg">FSMap.__getitem__</span><span class="ansi-blue-fg">(self, key, default)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 137</span>     result <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fs</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">cat</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    138</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>missing_exceptions:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:111</span>, in <span class="ansi-cyan-fg">sync_wrapper.&lt;locals&gt;.wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    110</span> <span style="color: rgb(0,135,0)">self</span> <span style="color: rgb(98,98,98)">=</span> obj <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> args[<span style="color: rgb(98,98,98)">0</span>]
<span class="ansi-green-fg">--&gt; 111</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">loop</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:96</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(loop, func, timeout, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">isinstance</span>(return_result, <span class="ansi-bold" style="color: rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">---&gt; 96</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-intense-fg ansi-bold">     97</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:53</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(event, coro, result, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">     52</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">---&gt; 53</span>     result[<span style="color: rgb(98,98,98)">0</span>] <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> coro
<span class="ansi-green-intense-fg ansi-bold">     54</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> ex:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/asyn.py:423</span>, in <span class="ansi-cyan-fg">AsyncFileSystem._cat</span><span class="ansi-blue-fg">(self, path, recursive, on_error, batch_size, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    422</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> ex:
<span class="ansi-green-fg">--&gt; 423</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ex
<span class="ansi-green-intense-fg ansi-bold">    424</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> (
<span class="ansi-green-intense-fg ansi-bold">    425</span>     <span style="color: rgb(0,135,0)">len</span>(paths) <span style="color: rgb(98,98,98)">&gt;</span> <span style="color: rgb(98,98,98)">1</span>
<span class="ansi-green-intense-fg ansi-bold">    426</span>     <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> <span style="color: rgb(0,135,0)">isinstance</span>(path, <span style="color: rgb(0,135,0)">list</span>)
<span class="ansi-green-intense-fg ansi-bold">    427</span>     <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> paths[<span style="color: rgb(98,98,98)">0</span>] <span style="color: rgb(98,98,98)">!=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_strip_protocol(path)
<span class="ansi-green-intense-fg ansi-bold">    428</span> ):

File <span class="ansi-green-fg">/usr/lib/python3.10/asyncio/tasks.py:408</span>, in <span class="ansi-cyan-fg">wait_for</span><span class="ansi-blue-fg">(fut, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    407</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> timeout <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">--&gt; 408</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> fut
<span class="ansi-green-intense-fg ansi-bold">    410</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> timeout <span style="color: rgb(98,98,98)">&lt;</span><span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">0</span>:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:955</span>, in <span class="ansi-cyan-fg">S3FileSystem._cat_file</span><span class="ansi-blue-fg">(self, path, version_id, start, end)</span>
<span class="ansi-green-intense-fg ansi-bold">    953</span>         resp[<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Body</span><span style="color: rgb(175,0,0)">&#34;</span>]<span style="color: rgb(98,98,98)">.</span>close()
<span class="ansi-green-fg">--&gt; 955</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> _error_wrapper(_call_and_read, retries<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>retries)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:137</span>, in <span class="ansi-cyan-fg">_error_wrapper</span><span class="ansi-blue-fg">(func, args, kwargs, retries)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span> err <span style="color: rgb(98,98,98)">=</span> translate_boto_error(err)
<span class="ansi-green-fg">--&gt; 137</span> <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> err

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:110</span>, in <span class="ansi-cyan-fg">_error_wrapper</span><span class="ansi-blue-fg">(func, args, kwargs, retries)</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 110</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> func(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-intense-fg ansi-bold">    111</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> S3_RETRYABLE_ERRORS <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:942</span>, in <span class="ansi-cyan-fg">S3FileSystem._cat_file.&lt;locals&gt;._call_and_read</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    941</span> <span class="ansi-bold" style="color: rgb(0,135,0)">async</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">_call_and_read</span>():
<span class="ansi-green-fg">--&gt; 942</span>     resp <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_call_s3(
<span class="ansi-green-intense-fg ansi-bold">    943</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">get_object</span><span style="color: rgb(175,0,0)">&#34;</span>,
<span class="ansi-green-intense-fg ansi-bold">    944</span>         Bucket<span style="color: rgb(98,98,98)">=</span>bucket,
<span class="ansi-green-intense-fg ansi-bold">    945</span>         Key<span style="color: rgb(98,98,98)">=</span>key,
<span class="ansi-green-intense-fg ansi-bold">    946</span>         <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>version_id_kw(version_id <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> vers),
<span class="ansi-green-intense-fg ansi-bold">    947</span>         <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>head,
<span class="ansi-green-intense-fg ansi-bold">    948</span>         <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span><span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>req_kw,
<span class="ansi-green-intense-fg ansi-bold">    949</span>     )
<span class="ansi-green-intense-fg ansi-bold">    950</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:332</span>, in <span class="ansi-cyan-fg">S3FileSystem._call_s3</span><span class="ansi-blue-fg">(self, method, *akwarglist, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    331</span> additional_kwargs <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_get_s3_method_kwargs(method, <span style="color: rgb(98,98,98)">*</span>akwarglist, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">--&gt; 332</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-bold" style="color: rgb(0,135,0)">await</span> _error_wrapper(
<span class="ansi-green-intense-fg ansi-bold">    333</span>     method, kwargs<span style="color: rgb(98,98,98)">=</span>additional_kwargs, retries<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>retries
<span class="ansi-green-intense-fg ansi-bold">    334</span> )

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/s3fs/core.py:137</span>, in <span class="ansi-cyan-fg">_error_wrapper</span><span class="ansi-blue-fg">(func, args, kwargs, retries)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span> err <span style="color: rgb(98,98,98)">=</span> translate_boto_error(err)
<span class="ansi-green-fg">--&gt; 137</span> <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> err

<span class="ansi-red-fg">FileNotFoundError</span>: The specified key does not exist.

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Input <span class="ansi-green-fg">In [103]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> root <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/convenience.py:1300</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(store, metadata_key, mode, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1297</span>         metadata_key <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">meta/root/consolidated/</span><span style="color: rgb(175,0,0)">&#39;</span> <span style="color: rgb(98,98,98)">+</span> metadata_key
<span class="ansi-green-intense-fg ansi-bold">   1299</span> <span style="color: rgb(95,135,135)"># setup metadata store</span>
<span class="ansi-green-fg">-&gt; 1300</span> meta_store <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">ConsolidatedStoreClass</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">metadata_key</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">metadata_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1302</span> <span style="color: rgb(95,135,135)"># pass through</span>
<span class="ansi-green-intense-fg ansi-bold">   1303</span> chunk_store <span style="color: rgb(98,98,98)">=</span> kwargs<span style="color: rgb(98,98,98)">.</span>pop(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">chunk_store</span><span style="color: rgb(175,0,0)">&#39;</span>, <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>) <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> store

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:2861</span>, in <span class="ansi-cyan-fg">ConsolidatedMetadataStore.__init__</span><span class="ansi-blue-fg">(self, store, metadata_key)</span>
<span class="ansi-green-intense-fg ansi-bold">   2858</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>store <span style="color: rgb(98,98,98)">=</span> Store<span style="color: rgb(98,98,98)">.</span>_ensure_store(store)
<span class="ansi-green-intense-fg ansi-bold">   2860</span> <span style="color: rgb(95,135,135)"># retrieve consolidated metadata</span>
<span class="ansi-green-fg">-&gt; 2861</span> meta <span style="color: rgb(98,98,98)">=</span> json_loads(<span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">metadata_key</span><span class="ansi-yellow-bg">]</span>)
<span class="ansi-green-intense-fg ansi-bold">   2863</span> <span style="color: rgb(95,135,135)"># check format of consolidated metadata</span>
<span class="ansi-green-intense-fg ansi-bold">   2864</span> consolidated_format <span style="color: rgb(98,98,98)">=</span> meta<span style="color: rgb(98,98,98)">.</span>get(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">zarr_consolidated_format</span><span style="color: rgb(175,0,0)">&#39;</span>, <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:724</span>, in <span class="ansi-cyan-fg">KVStore.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-intense-fg ansi-bold">    723</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">__getitem__</span>(<span style="color: rgb(0,135,0)">self</span>, key):
<span class="ansi-green-fg">--&gt; 724</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_mutable_mapping</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">]</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/fsspec/mapping.py:141</span>, in <span class="ansi-cyan-fg">FSMap.__getitem__</span><span class="ansi-blue-fg">(self, key, default)</span>
<span class="ansi-green-intense-fg ansi-bold">    139</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> default <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-intense-fg ansi-bold">    140</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> default
<span class="ansi-green-fg">--&gt; 141</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">KeyError</span>(key)
<span class="ansi-green-intense-fg ansi-bold">    142</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> result

<span class="ansi-red-fg">KeyError</span>: &#39;.zmetadata&#39;
</pre></div></div>
</div>
<p>This uses the special key to read all of the metadata in a single call to the backend storage.</p>
<p>Note that, the hierarchy could still be opened in the normal way and altered, causing the consolidated metadata to become out of sync with the real state of the array hierarchy. In this case, <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.consolidate_metadata()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.consolidate_metadata">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.consolidate_metadata</a>&gt;`__ would need to be called again.</p>
<p>To protect against consolidated metadata accidentally getting out of sync, the root group returned by <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.open_consolidated()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open_consolidated">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.open_consolidated</a>&gt;`__ is read-only for the metadata, meaning that no new groups or arrays can be created, and arrays cannot be resized. However, data values with arrays can still be updated.</p>
<p>##Copying/Migrating Data</p>
<p>If you have some data in an HDF5 file and would like to copy some or all of it into a Zarr group, or vice-versa, the <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.copy()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy</a>&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.copy_all()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_all">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_all</a>&gt;`__ functions can be used. Here’s an example copying a group named ‘foo’ from an HDF5 file to a Zarr group:</p>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import h5py
import zarr
import numpy as np
source = h5py.File(&#39;data/example.h5&#39;, mode=&#39;w&#39;)
foo = source.create_group(&#39;foo&#39;)
baz = foo.create_dataset(&#39;bar/baz&#39;, data=np.arange(100), chunks=(50,))
spam = source.create_dataset(&#39;spam&#39;, data=np.arange(100, 200), chunks=(30,))
zarr.tree(source)
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 ├── foo
 │   └── bar
 │       └── baz (100,) int64
 └── spam (100,) int64
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>est = zarr.open_group(&#39;data/example.zarr&#39;, mode=&#39;w&#39;)
from sys import stdout
zarr.copy(source[&#39;foo&#39;], dest, log=stdout)
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>copy /foo
copy /foo/bar
copy /foo/bar/baz (100,) int64
all done: 3 copied, 0 skipped, 800 bytes copied
(3, 0, 800)
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># N.B., no spam
dest.tree()
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 └── foo
     └── bar
         └── baz (100,) int64
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source.close()
</pre></div>
</div>
<p>If rather than copying a single group or array you would like to copy all groups and arrays, use <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.copy_all()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_all">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_all</a>&gt;`__, e.g.:</p>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source = h5py.File(&#39;data/example.h5&#39;, mode=&#39;r&#39;)
dest = zarr.open_group(&#39;data/example2.zarr&#39;, mode=&#39;w&#39;)
zarr.copy_all(source, dest, log=stdout)
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>copy /foo
copy /foo/bar
copy /foo/bar/baz (100,) int64
copy /spam (100,) int64
all done: 4 copied, 0 skipped, 1,600 bytes copied
(4, 0, 1600)
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dest.tree()
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 ├── foo
 │   └── bar
 │       └── baz (100,) int64
 └── spam (100,) int64
</pre></div>
</div>
<p>If you need to copy data between two Zarr groups, the <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.copy()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy</a>&gt;`__ and <code class="docutils literal notranslate"><span class="pre">`zarr.convenience.copy_all()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_all">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_all</a>&gt;`__ functions can be used and provide the most flexibility. However, if you want to copy data in the most efficient way possible, without changing any configuration options, the
<code class="docutils literal notranslate"><span class="pre">`zarr.convenience.copy_store()</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_store">https://zarr.readthedocs.io/en/stable/api/convenience.html#zarr.convenience.copy_store</a>&gt;`__ function can be used. This function copies data directly between the underlying stores, without any decompression or re-compression, and so should be faster. E.g.:</p>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import zarr
import numpy as np
store1 = zarr.DirectoryStore(&#39;data/example.zarr&#39;)
root = zarr.group(store1, overwrite=True)
baz = root.create_dataset(&#39;foo/bar/baz&#39;, data=np.arange(100), chunks=(50,))
spam = root.create_dataset(&#39;spam&#39;, data=np.arange(100, 200), chunks=(30,))
root.tree()
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 ├── foo
 │   └── bar
 │       └── baz (100,) int64
 └── spam (100,) int64
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>from sys import stdout
store2 = zarr.ZipStore(&#39;data/example.zip&#39;, mode=&#39;w&#39;)
zarr.copy_store(store1, store2, log=stdout)
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>copy .zgroup
copy foo/.zgroup
copy foo/bar/.zgroup
copy foo/bar/baz/.zarray
copy foo/bar/baz/0
copy foo/bar/baz/1
copy spam/.zarray
copy spam/0
copy spam/1
copy spam/2
copy spam/3
all done: 11 copied, 0 skipped, 1,138 bytes copied
(11, 0, 1138)
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>new_root = zarr.group(store2)
new_root.tree()
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/
 ├── foo
 │   └── bar
 │       └── baz (100,) int64
 └── spam (100,) int64
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>new_root[&#39;foo/bar/baz&#39;][:]
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([ 0,  1,  2,  ..., 97, 98, 99])
</pre></div>
</div>
<p>Input</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># zip stores need to be closed
store2.close()
</pre></div>
</div>
<p>##String Arrays</p>
<p>There are several options for storing arrays of strings.</p>
<p>If your strings are all ASCII strings, and you know the maximum length of the string in your array, then you can use an array with a fixed-length bytes dtype. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;S6&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (10,) |S6&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Hello&#39;</span>
<span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;world!&#39;</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([b&#39;Hello&#39;, b&#39;world!&#39;, b&#39;&#39;, b&#39;&#39;, b&#39;&#39;, b&#39;&#39;, b&#39;&#39;, b&#39;&#39;, b&#39;&#39;, b&#39;&#39;],
      dtype=&#39;|S6&#39;)
</pre></div></div>
</div>
<p>A fixed-length unicode dtype is also available, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">greetings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;¡Hola mundo!&#39;</span><span class="p">,</span> <span class="s1">&#39;Hej Världen!&#39;</span><span class="p">,</span> <span class="s1">&#39;Servus Woid!&#39;</span><span class="p">,</span> <span class="s1">&#39;Hei maailma!&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Xin chào thế giới&#39;</span><span class="p">,</span> <span class="s1">&#39;Njatjeta Botë!&#39;</span><span class="p">,</span> <span class="s1">&#39;Γεια σου κόσμε!&#39;</span><span class="p">,</span>
             <span class="s1">&#39;こんにちは世界&#39;</span><span class="p">,</span> <span class="s1">&#39;世界，你好！&#39;</span><span class="p">,</span> <span class="s1">&#39;Helló, világ!&#39;</span><span class="p">,</span> <span class="s1">&#39;Zdravo svete!&#39;</span><span class="p">,</span>
             <span class="s1">&#39;เฮลโลเวิลด์&#39;</span><span class="p">]</span>
<span class="n">text_data</span> <span class="o">=</span> <span class="n">greetings</span> <span class="o">*</span> <span class="mi">10000</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U20&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (120000,) &lt;U20&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[107]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[107]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;¡Hola mundo!&#39;, &#39;Hej Världen!&#39;, &#39;Servus Woid!&#39;, ...,
       &#39;Helló, világ!&#39;, &#39;Zdravo svete!&#39;, &#39;เฮลโลเวิลด์&#39;], dtype=&#39;&lt;U20&#39;)
</pre></div></div>
</div>
<p>For variable-length strings, the <code class="docutils literal notranslate"><span class="pre">object</span></code> dtype can be used, but a codec must be provided to encode the data (see also <a class="reference external" href="#object-arrays">Object Arrays</a> below). At the time of writing there are four codecs available that can encode variable length string objects: <code class="docutils literal notranslate"><span class="pre">numcodecs.VLenUTF8</span></code>, <code class="docutils literal notranslate"><span class="pre">numcodecs.JSON</span></code>, <code class="docutils literal notranslate"><span class="pre">numcodecs.MsgPack</span></code>. and <code class="docutils literal notranslate"><span class="pre">numcodecs.Pickle</span></code>. E.g. using <code class="docutils literal notranslate"><span class="pre">VLenUTF8</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[108]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numcodecs</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">object_codec</span><span class="o">=</span><span class="n">numcodecs</span><span class="o">.</span><span class="n">VLenUTF8</span><span class="p">())</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[108]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (120000,) object&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[109]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">filters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[109]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[VLenUTF8()]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;¡Hola mundo!&#39;, &#39;Hej Världen!&#39;, &#39;Servus Woid!&#39;, ...,
       &#39;Helló, világ!&#39;, &#39;Zdravo svete!&#39;, &#39;เฮลโลเวิลด์&#39;], dtype=object)
</pre></div></div>
</div>
<p>As a convenience, <code class="docutils literal notranslate"><span class="pre">dtype=str</span></code> (or <code class="docutils literal notranslate"><span class="pre">dtype=unicode</span></code> on Python 2.7) can be used, which is a short-hand for <code class="docutils literal notranslate"><span class="pre">dtype=object,</span> <span class="pre">object_codec=numcodecs.VLenUTF8()</span></code>, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (120000,) object&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">filters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[VLenUTF8()]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;¡Hola mundo!&#39;, &#39;Hej Världen!&#39;, &#39;Servus Woid!&#39;, ...,
       &#39;Helló, világ!&#39;, &#39;Zdravo svete!&#39;, &#39;เฮลโลเวิลด์&#39;], dtype=object)
</pre></div></div>
</div>
<p>Variable-length byte strings are also supported via <code class="docutils literal notranslate"><span class="pre">dtype=object</span></code>. Again an <code class="docutils literal notranslate"><span class="pre">object_codec</span></code> is required, which can be one of <code class="docutils literal notranslate"><span class="pre">numcodecs.VLenBytes</span></code> or <code class="docutils literal notranslate"><span class="pre">numcodecs.Pickle</span></code>. For convenience, <code class="docutils literal notranslate"><span class="pre">dtype=bytes</span></code> (or <code class="docutils literal notranslate"><span class="pre">dtype=str</span></code> on Python 2.7) can be used as a short-hand for <code class="docutils literal notranslate"><span class="pre">dtype=object,</span> <span class="pre">object_codec=numcodecs.VLenBytes()</span></code>, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bytes_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">greetings</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10000</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bytes_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bytes</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (120000,) object&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">filters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[VLenBytes()]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[116]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[116]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([b&#39;\xc2\xa1Hola mundo!&#39;, b&#39;Hej V\xc3\xa4rlden!&#39;, b&#39;Servus Woid!&#39;,
       ..., b&#39;Hell\xc3\xb3, vil\xc3\xa1g!&#39;, b&#39;Zdravo svete!&#39;,
       b&#39;\xe0\xb9\x80\xe0\xb8\xae\xe0\xb8\xa5\xe0\xb9\x82\xe0\xb8\xa5\xe0\xb9\x80\xe0\xb8\xa7\xe0\xb8\xb4\xe0\xb8\xa5\xe0\xb8\x94\xe0\xb9\x8c&#39;],
      dtype=object)
</pre></div></div>
</div>
<p>If you know ahead of time all the possible string values that can occur, you could also use the <code class="docutils literal notranslate"><span class="pre">numcodecs.Categorize</span></code> codec to encode each unique string value as an integer. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[117]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorize</span> <span class="o">=</span> <span class="n">numcodecs</span><span class="o">.</span><span class="n">Categorize</span><span class="p">(</span><span class="n">greetings</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">object_codec</span><span class="o">=</span><span class="n">categorize</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[117]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (120000,) object&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[118]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">filters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[118]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Categorize(dtype=&#39;|O&#39;, astype=&#39;|u1&#39;, labels=[&#39;¡Hola mundo!&#39;, &#39;Hej Världen!&#39;, &#39;Servus Woid!&#39;, ...])]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[119]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[119]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;¡Hola mundo!&#39;, &#39;Hej Världen!&#39;, &#39;Servus Woid!&#39;, ...,
       &#39;Helló, világ!&#39;, &#39;Zdravo svete!&#39;, &#39;เฮลโลเวิลด์&#39;], dtype=object)
</pre></div></div>
</div>
<p>##Object Arrays</p>
<p>Zarr supports arrays with an “object” dtype. This allows arrays to contain any type of object, such as variable length unicode strings, or variable length arrays of numbers, or other possibilities. When creating an object array, a codec must be provided via the <code class="docutils literal notranslate"><span class="pre">object_codec</span></code> argument. This codec handles encoding (serialization) of Python objects. The best codec to use will depend on what type of objects are present in the array.</p>
<p>At the time of writing there are three codecs available that can serve as a general purpose object codec and support encoding of a mixture of object types: <code class="docutils literal notranslate"><span class="pre">numcodecs.JSON</span></code>, <code class="docutils literal notranslate"><span class="pre">numcodecs.MsgPack</span></code>. and <code class="docutils literal notranslate"><span class="pre">numcodecs.Pickle</span></code>.</p>
<p>For example, using the JSON codec:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[120]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">object_codec</span><span class="o">=</span><span class="n">numcodecs</span><span class="o">.</span><span class="n">JSON</span><span class="p">())</span>
<span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
<span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;qux&#39;</span><span class="p">]</span>
<span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">2.2</span><span class="p">}</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[120]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([42, &#39;foo&#39;, list([&#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]), {&#39;a&#39;: 1, &#39;b&#39;: 2.2}, None],
      dtype=object)
</pre></div></div>
</div>
<p>Not all codecs support encoding of all object types. The numcodecs.Pickle codec is the most flexible, supporting encoding any type of Python object. However, if you are sharing data with anyone other than yourself, then Pickle is not recommended as it is a potential security risk. This is because malicious code can be embedded within pickled data. The JSON and MsgPack codecs do not have any security issues and support encoding of unicode strings, lists and dictionaries. MsgPack is usually faster
for both encoding and decoding.</p>
<p>###Ragged Arrays</p>
<p>If you need to store an array of arrays, where each member array can be of any length and stores the same primitive type (a.k.a. a ragged array), the <code class="docutils literal notranslate"><span class="pre">numcodecs.VLenArray</span></code> codec can be used, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[121]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">object_codec</span><span class="o">=</span><span class="n">numcodecs</span><span class="o">.</span><span class="n">VLenArray</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[121]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (4,) object&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[122]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">filters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[122]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[VLenArray(dtype=&#39;&lt;i8&#39;)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[123]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">])</span>
<span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[123]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([array([1, 3, 5]), array([4]), array([ 7,  9, 14]),
       array([], dtype=int64)], dtype=object)
</pre></div></div>
</div>
<p>As a convenience, <code class="docutils literal notranslate"><span class="pre">dtype='array:T'</span></code> can be used as a short-hand for <code class="docutils literal notranslate"><span class="pre">dtype=object,</span> <span class="pre">object_codec=numcodecs.VLenArray('T')</span></code>, where ‘T’ can be any NumPy primitive dtype such as ‘i4’ or ‘f8’. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[124]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;array:i8&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[124]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (4,) object&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[125]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">filters</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[125]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[VLenArray(dtype=&#39;&lt;i8&#39;)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[126]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">])</span>
<span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">])</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[126]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([array([1, 3, 5]), array([4]), array([ 7,  9, 14]),
       array([], dtype=int64)], dtype=object)
</pre></div></div>
</div>
<p>##Chunk Optimisations</p>
<p>###Chunk Size and Shape</p>
<p>In general, chunks of at least 1 megabyte (1M) uncompressed size seem to provide better performance, at least when using the Blosc compression library.</p>
<p>The optimal chunk shape will depend on how you want to access the data. E.g., for a 2-dimensional array, if you only ever take slices along the first dimension, then chunk across the second dimenson. If you know you want to chunk across an entire dimension you can use <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">-1</span></code> within the chunks argument, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[127]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z1</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z1</span><span class="o">.</span><span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[127]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(100, 10000)
</pre></div></div>
</div>
<p>Alternatively, if you only ever take slices along the second dimension, then chunk across the first dimension, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[128]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z2</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z2</span><span class="o">.</span><span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[128]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 100)
</pre></div></div>
</div>
<p>If you require reasonable performance for both access patterns then you need to find a compromise, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[129]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z3</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z3</span><span class="o">.</span><span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[129]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1000, 1000)
</pre></div></div>
</div>
<p>If you are feeling lazy, you can let Zarr guess a chunk shape for your data by providing <code class="docutils literal notranslate"><span class="pre">chunks=True</span></code>, although please note that the algorithm for guessing a chunk shape is based on simple heuristics and may be far from optimal. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z4</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z4</span><span class="o">.</span><span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(625, 625)
</pre></div></div>
</div>
<p>If you know you are always going to be loading the entire array into memory, you can turn off chunks by providing <code class="docutils literal notranslate"><span class="pre">chunks=False</span></code>, in which case there will be one single chunk for the array:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[131]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z5</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z5</span><span class="o">.</span><span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[131]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 10000)
</pre></div></div>
</div>
<p>###Chunk Memory Layout</p>
<p>The order of bytes <strong>within each chunk</strong> of an array can be changed via the <code class="docutils literal notranslate"><span class="pre">order</span></code> keyword argument, to use either C or Fortran layout. For multi-dimensional arrays, these two layouts may provide different compression ratios, depending on the correlation structure within the data. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[132]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">c</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[132]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">int32</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(10000, 10000)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(1000, 1000)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">C</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='lz4', clevel=5, shuffle=SHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.KVStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">400000000 (381.5M)</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">5274440 (5.0M)</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">75.8</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">100/100</td></tr></tbody></table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[133]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[133]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="zarr-info"><tbody><tr><th style="text-align: left">Type</th><td style="text-align: left">zarr.core.Array</td></tr><tr><th style="text-align: left">Data type</th><td style="text-align: left">int32</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(10000, 10000)</td></tr><tr><th style="text-align: left">Chunk shape</th><td style="text-align: left">(1000, 1000)</td></tr><tr><th style="text-align: left">Order</th><td style="text-align: left">F</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">False</td></tr><tr><th style="text-align: left">Compressor</th><td style="text-align: left">Blosc(cname='lz4', clevel=5, shuffle=SHUFFLE, blocksize=0)</td></tr><tr><th style="text-align: left">Store type</th><td style="text-align: left">zarr.storage.KVStore</td></tr><tr><th style="text-align: left">No. bytes</th><td style="text-align: left">400000000 (381.5M)</td></tr><tr><th style="text-align: left">No. bytes stored</th><td style="text-align: left">4197917 (4.0M)</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">95.3</td></tr><tr><th style="text-align: left">Chunks initialized</th><td style="text-align: left">100/100</td></tr></tbody></table></div>
</div>
<p>In the above example, Fortran order gives a better compression ratio. This is an artificial example but illustrates the general point that changing the order of bytes within chunks of an array may improve the compression ratio, depending on the structure of the data, the compression algorithm used, and which compression filters (e.g., byte-shuffle) have been applied.</p>
<p>###Empty Chunks</p>
<p>As of version 2.11, it is possible to configure how Zarr handles the storage of chunks that are “empty” (i.e., every element in the chunk is equal to the array’s fill value). When creating an array with <code class="docutils literal notranslate"><span class="pre">write_empty_chunks=False</span></code> (the default), Zarr will check whether a chunk is empty before compression and storage. If a chunk is empty, then Zarr does not store it, and instead deletes the chunk from storage if the chunk had been previously stored.</p>
<p>This optimization prevents storing redundant objects and can speed up reads, but the cost is added computation during array writes, since the contents of each chunk must be compared to the fill value, and these advantages are contingent on the content of the array. If you know that your data will form chunks that are almost always non-empty, then there is no advantage to the optimization described above. In this case, creating an array with <code class="docutils literal notranslate"><span class="pre">write_empty_chunks=True</span></code> will instruct Zarr to write
every chunk without checking for emptiness.</p>
<p>The following example illustrates the effect of the <code class="docutils literal notranslate"><span class="pre">write_empty_chunks</span></code> flag on the time required to write an array with different values.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[134]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zarr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="k">def</span> <span class="nf">timed_write</span><span class="p">(</span><span class="n">write_empty_chunks</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Measure the time required and number of objects created when writing</span>
<span class="sd">  to a Zarr array with random ints or fill value.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">chunks</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8192</span><span class="p">,)</span>
  <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span>

  <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="p">,</span>
                    <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                    <span class="n">write_empty_chunks</span><span class="o">=</span><span class="n">write_empty_chunks</span><span class="p">,</span>
                    <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1"># Initialize all chunks</span>
    <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">fill_value</span><span class="p">):</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
      <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">value</span>
      <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">elapsed</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">nchunks_initialized</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="k">for</span> <span class="n">write_empty_chunks</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
  <span class="n">full</span><span class="p">,</span> <span class="n">empty</span> <span class="o">=</span> <span class="n">timed_write</span><span class="p">(</span><span class="n">write_empty_chunks</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">write_empty_chunks=</span><span class="si">{</span><span class="n">write_empty_chunks</span><span class="si">}</span><span class="s1">:</span><span class="se">\n\t</span><span class="s1">Random Data: </span><span class="si">{</span><span class="n">full</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s, </span><span class="si">{</span><span class="n">full</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> objects stored</span><span class="se">\n\t</span><span class="s1"> Empty Data: </span><span class="si">{</span><span class="n">empty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s, </span><span class="si">{</span><span class="n">empty</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> objects stored</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

write_empty_chunks=True:
        Random Data: 1.5481s, 1024 objects stored
         Empty Data: 1.3192s, 1024 objects stored


write_empty_chunks=False:
        Random Data: 1.4012s, 1024 objects stored
         Empty Data: 0.2244s, 0 objects stored

</pre></div></div>
</div>
<p>In this example, writing random data is slightly slower with <code class="docutils literal notranslate"><span class="pre">write_empty_chunks=True</span></code>, but writing empty data is substantially faster and generates far fewer objects in storage.</p>
<p>###Changing Chunk Shapes (Rechunking)</p>
<p>Sometimes you are not free to choose the initial chunking of your input data, or you might have data saved with chunking which is not optimal for the analysis you have planned. In such cases it can be advantageous to re-chunk the data. For small datasets, or when the mismatch between input and output chunks is small such that only a few chunks of the input dataset need to be read to create each chunk in the output array, it is sufficient to simply copy the data to a new array with the desired
chunking, e.g.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[135]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="s1">&#39;a.zarr&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">store</span><span class="o">=</span><span class="s1">&#39;b.zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ContainsArrayError</span>                        Traceback (most recent call last)
Input <span class="ansi-green-fg">In [135]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> a <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">zeros</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10000</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10000</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">100</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">100</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">uint16</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">a.zarr</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> b <span style="color: rgb(98,98,98)">=</span> zarr<span style="color: rgb(98,98,98)">.</span>array(a, chunks<span style="color: rgb(98,98,98)">=</span>(<span style="color: rgb(98,98,98)">100</span>, <span style="color: rgb(98,98,98)">200</span>), store<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">b.zarr</span><span style="color: rgb(175,0,0)">&#39;</span>)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/creation.py:279</span>, in <span class="ansi-cyan-fg">zeros</span><span class="ansi-blue-fg">(shape, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">zeros</span>(shape, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Create an array, with zero being used as the default value for</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span> <span style="color: rgb(175,0,0)">    uninitialized portions of the array.</span>
<span class="ansi-green-intense-fg ansi-bold">    264</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    276</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span> <span style="color: rgb(175,0,0)">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 279</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">create</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/creation.py:169</span>, in <span class="ansi-cyan-fg">create</span><span class="ansi-blue-fg">(shape, chunks, dtype, compressor, fill_value, order, store, synchronizer, overwrite, path, chunk_store, filters, cache_metadata, cache_attrs, read_only, object_codec, dimension_separator, write_empty_chunks, zarr_version, meta_array, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    166</span>     path <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">/</span><span style="color: rgb(175,0,0)">&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">    168</span> <span style="color: rgb(95,135,135)"># initialize array metadata</span>
<span class="ansi-green-fg">--&gt; 169</span> <span class="ansi-yellow-bg">init_array</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    170</span> <span class="ansi-yellow-bg">           </span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span> <span class="ansi-yellow-bg">           </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span> <span class="ansi-yellow-bg">           </span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    174</span> <span style="color: rgb(95,135,135)"># instantiate array</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span> z <span style="color: rgb(98,98,98)">=</span> Array(store, path<span style="color: rgb(98,98,98)">=</span>path, chunk_store<span style="color: rgb(98,98,98)">=</span>chunk_store, synchronizer<span style="color: rgb(98,98,98)">=</span>synchronizer,
<span class="ansi-green-intense-fg ansi-bold">    176</span>           cache_metadata<span style="color: rgb(98,98,98)">=</span>cache_metadata, cache_attrs<span style="color: rgb(98,98,98)">=</span>cache_attrs, read_only<span style="color: rgb(98,98,98)">=</span>read_only,
<span class="ansi-green-intense-fg ansi-bold">    177</span>           write_empty_chunks<span style="color: rgb(98,98,98)">=</span>write_empty_chunks, meta_array<span style="color: rgb(98,98,98)">=</span>meta_array)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:426</span>, in <span class="ansi-cyan-fg">init_array</span><span class="ansi-blue-fg">(store, shape, chunks, dtype, compressor, fill_value, order, overwrite, path, chunk_store, filters, object_codec, dimension_separator)</span>
<span class="ansi-green-intense-fg ansi-bold">    423</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> compressor:
<span class="ansi-green-intense-fg ansi-bold">    424</span>     <span style="color: rgb(95,135,135)"># compatibility with legacy tests using compressor=[]</span>
<span class="ansi-green-intense-fg ansi-bold">    425</span>     compressor <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">--&gt; 426</span> <span class="ansi-yellow-bg">_init_array_metadata</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    427</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    428</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    429</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    430</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    431</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:485</span>, in <span class="ansi-cyan-fg">_init_array_metadata</span><span class="ansi-blue-fg">(store, shape, chunks, dtype, compressor, fill_value, order, overwrite, path, chunk_store, filters, object_codec, dimension_separator)</span>
<span class="ansi-green-intense-fg ansi-bold">    483</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> overwrite:
<span class="ansi-green-intense-fg ansi-bold">    484</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> contains_array(store, path):
<span class="ansi-green-fg">--&gt; 485</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ContainsArrayError(path)
<span class="ansi-green-intense-fg ansi-bold">    486</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> contains_group(store, path, explicit_only<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):
<span class="ansi-green-intense-fg ansi-bold">    487</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ContainsGroupError(path)

<span class="ansi-red-fg">ContainsArrayError</span>: path &#39;&#39; contains an array
</pre></div></div>
</div>
<p>If the chunk shapes mismatch, however, a simple copy can lead to non-optimal data access patterns and incur a substantial performance hit when using file based stores. One of the most pathological examples is switching from column-based chunking to row-based chunking e.g.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[136]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="s1">&#39;a.zarr&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span> <span class="n">store</span><span class="o">=</span><span class="s1">&#39;b.zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ContainsArrayError</span>                        Traceback (most recent call last)
Input <span class="ansi-green-fg">In [136]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> a <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">zeros</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10000</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10000</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10000</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">uint16</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">a.zarr</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> b <span style="color: rgb(98,98,98)">=</span> zarr<span style="color: rgb(98,98,98)">.</span>array(a, chunks<span style="color: rgb(98,98,98)">=</span>(<span style="color: rgb(98,98,98)">1</span>,<span style="color: rgb(98,98,98)">10000</span>), store<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">b.zarr</span><span style="color: rgb(175,0,0)">&#39;</span>)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/creation.py:279</span>, in <span class="ansi-cyan-fg">zeros</span><span class="ansi-blue-fg">(shape, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">zeros</span>(shape, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Create an array, with zero being used as the default value for</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span> <span style="color: rgb(175,0,0)">    uninitialized portions of the array.</span>
<span class="ansi-green-intense-fg ansi-bold">    264</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    276</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span> <span style="color: rgb(175,0,0)">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 279</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">create</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/creation.py:169</span>, in <span class="ansi-cyan-fg">create</span><span class="ansi-blue-fg">(shape, chunks, dtype, compressor, fill_value, order, store, synchronizer, overwrite, path, chunk_store, filters, cache_metadata, cache_attrs, read_only, object_codec, dimension_separator, write_empty_chunks, zarr_version, meta_array, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    166</span>     path <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">/</span><span style="color: rgb(175,0,0)">&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">    168</span> <span style="color: rgb(95,135,135)"># initialize array metadata</span>
<span class="ansi-green-fg">--&gt; 169</span> <span class="ansi-yellow-bg">init_array</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    170</span> <span class="ansi-yellow-bg">           </span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span> <span class="ansi-yellow-bg">           </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span> <span class="ansi-yellow-bg">           </span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    174</span> <span style="color: rgb(95,135,135)"># instantiate array</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span> z <span style="color: rgb(98,98,98)">=</span> Array(store, path<span style="color: rgb(98,98,98)">=</span>path, chunk_store<span style="color: rgb(98,98,98)">=</span>chunk_store, synchronizer<span style="color: rgb(98,98,98)">=</span>synchronizer,
<span class="ansi-green-intense-fg ansi-bold">    176</span>           cache_metadata<span style="color: rgb(98,98,98)">=</span>cache_metadata, cache_attrs<span style="color: rgb(98,98,98)">=</span>cache_attrs, read_only<span style="color: rgb(98,98,98)">=</span>read_only,
<span class="ansi-green-intense-fg ansi-bold">    177</span>           write_empty_chunks<span style="color: rgb(98,98,98)">=</span>write_empty_chunks, meta_array<span style="color: rgb(98,98,98)">=</span>meta_array)

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:426</span>, in <span class="ansi-cyan-fg">init_array</span><span class="ansi-blue-fg">(store, shape, chunks, dtype, compressor, fill_value, order, overwrite, path, chunk_store, filters, object_codec, dimension_separator)</span>
<span class="ansi-green-intense-fg ansi-bold">    423</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> compressor:
<span class="ansi-green-intense-fg ansi-bold">    424</span>     <span style="color: rgb(95,135,135)"># compatibility with legacy tests using compressor=[]</span>
<span class="ansi-green-intense-fg ansi-bold">    425</span>     compressor <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">--&gt; 426</span> <span class="ansi-yellow-bg">_init_array_metadata</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    427</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">compressor</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">fill_value</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    428</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">order</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">overwrite</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    429</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">filters</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    430</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">object_codec</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    431</span> <span class="ansi-yellow-bg">                     </span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dimension_separator</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/.local/lib/python3.10/site-packages/zarr/storage.py:485</span>, in <span class="ansi-cyan-fg">_init_array_metadata</span><span class="ansi-blue-fg">(store, shape, chunks, dtype, compressor, fill_value, order, overwrite, path, chunk_store, filters, object_codec, dimension_separator)</span>
<span class="ansi-green-intense-fg ansi-bold">    483</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> overwrite:
<span class="ansi-green-intense-fg ansi-bold">    484</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> contains_array(store, path):
<span class="ansi-green-fg">--&gt; 485</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ContainsArrayError(path)
<span class="ansi-green-intense-fg ansi-bold">    486</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> contains_group(store, path, explicit_only<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):
<span class="ansi-green-intense-fg ansi-bold">    487</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ContainsGroupError(path)

<span class="ansi-red-fg">ContainsArrayError</span>: path &#39;&#39; contains an array
</pre></div></div>
</div>
<p>which will require every chunk in the input data set to be repeatedly read when creating each output chunk. If the entire array will fit within memory, this is simply resolved by forcing the entire input array into memory as a numpy array before converting back to zarr with the desired chunking.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16, store=&#39;</span><span class="n">a</span><span class="o">.</span><span class="n">zarr</span><span class="s1">&#39;)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span> <span class="n">store</span><span class="o">=</span><span class="s1">&#39;c.zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-fg">  Input </span><span class="ansi-green-fg">In [137]</span>
<span class="ansi-red-fg">    a = zarr.zeros((10000,10000), chunks=(10000, 1), dtype=&#39;uint16, store=&#39;a.zarr&#39;)</span>
                                                                                 ^
<span class="ansi-red-fg">SyntaxError</span><span class="ansi-red-fg">:</span> unterminated string literal (detected at line 1)

</pre></div></div>
</div>
<p>For data sets which have mismatched chunks and which do not fit in memory, a more sophisticated approach to rechunking, such as offered by the <a class="reference external" href="https://github.com/pangeo-data/rechunker">rechunker</a> package and discussed <a class="reference external" href="https://medium.com/pangeo/rechunker-the-missing-link-for-chunked-array-analytics-5b2359e9dc11">here</a> may offer a substantial improvement in performance.</p>
<p>##Parallel Computing and Synchronization</p>
<p>Zarr arrays have been designed for use as the source or sink for data in parallel computations. By data source we mean that multiple concurrent read operations may occur. By data sink we mean that multiple concurrent write operations may occur, with each writer updating a different region of the array. Zarr arrays have not been designed for situations where multiple readers and writers are concurrently operating on the same array.</p>
<p>Both multi-threaded and multi-process parallelism are possible. The bottleneck for most storage and retrieval operations is compression/decompression, and the Python global interpreter lock (GIL) is released wherever possible during these operations, so Zarr will generally not block other Python threads from running.</p>
<p>When using a Zarr array as a data sink, some synchronization (locking) may be required to avoid data loss, depending on how data are being updated. If each worker in a parallel computation is writing to a separate region of the array, and if region boundaries are perfectly aligned with chunk boundaries, then no synchronization is required. However, if region and chunk boundaries are not perfectly aligned, then synchronization is required to avoid two workers attempting to modify the same chunk
at the same time, which could result in data loss.</p>
<p>To give a simple example, consider a 1-dimensional array of length 60, <code class="docutils literal notranslate"><span class="pre">z</span></code>, divided into three chunks of 20 elements each. If three workers are running and each attempts to write to a 20 element region (i.e., <code class="docutils literal notranslate"><span class="pre">z[0:20]</span></code>, <code class="docutils literal notranslate"><span class="pre">z[20:40]</span></code> and <code class="docutils literal notranslate"><span class="pre">z[40:60]</span></code>) then each worker will be writing to a separate chunk and no synchronization is required. However, if two workers are running and each attempts to write to a 30 element region (i.e., <code class="docutils literal notranslate"><span class="pre">z[0:30]</span></code> and <code class="docutils literal notranslate"><span class="pre">z[30:60]</span></code>) then it is possible both workers
will attempt to modify the middle chunk at the same time, and synchronization is required to prevent data loss.</p>
<p>Zarr provides support for chunk-level synchronization. E.g., create an array with thread synchronization:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[138]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span>
               <span class="n">synchronizer</span><span class="o">=</span><span class="n">zarr</span><span class="o">.</span><span class="n">ThreadSynchronizer</span><span class="p">())</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[138]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>This array is safe to read or write within a multi-threaded program.</p>
<p>Zarr also provides support for process synchronization via file locking, provided that all processes have access to a shared file system, and provided that the underlying file system supports file locking (which is not the case for some networked file systems). E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[139]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">synchronizer</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">ProcessSynchronizer</span><span class="p">(</span><span class="s1">&#39;data/example.sync&#39;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_array</span><span class="p">(</span><span class="s1">&#39;data/example&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
                    <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                    <span class="n">synchronizer</span><span class="o">=</span><span class="n">synchronizer</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[139]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (10000, 10000) int32&gt;
</pre></div></div>
</div>
<p>This array is safe to read or write from multiple processes.</p>
<p>When using multiple processes to parallelize reads or writes on arrays using the Blosc compression library, it may be necessary to set <code class="docutils literal notranslate"><span class="pre">numcodecs.blosc.use_threads</span> <span class="pre">=</span> <span class="pre">False</span></code>, as otherwise Blosc may share incorrect global state amongst processes causing programs to hang. See also the section on <a class="reference external" href="#configuring-blosc">Configuring Blosc</a> below.</p>
<p>Please note that support for parallel computing is an area of ongoing research and development. If you are using Zarr for parallel computing, we welcome feedback, experience, discussion, ideas and advice, particularly about issues related to data integrity and performance.</p>
<p>##Pickle Support</p>
<p>Zarr arrays and groups can be pickled, as long as the underlying store object can be pickled. Instances of any of the storage classes provided in the <code class="docutils literal notranslate"><span class="pre">zarr.storage</span></code> module can be pickled, as can the built-in <code class="docutils literal notranslate"><span class="pre">dict</span></code> class which can also be used for storage.</p>
<p>Note that if an array or group is backed by an in-memory store like a <code class="docutils literal notranslate"><span class="pre">dict</span></code> or <code class="docutils literal notranslate"><span class="pre">`zarr.storage.MemoryStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.MemoryStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.MemoryStore</a>&gt;`__, then when it is pickled all of the store data will be included in the pickled data. However, if an array or group is backed by a persistent store like a <code class="docutils literal notranslate"><span class="pre">`zarr.storage.DirectoryStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DirectoryStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DirectoryStore</a>&gt;`__,
<code class="docutils literal notranslate"><span class="pre">`zarr.storage.ZipStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ZipStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.ZipStore</a>&gt;`__ or <code class="docutils literal notranslate"><span class="pre">`zarr.storage.DBMStore</span></code> &lt;<a class="reference external" href="https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DBMStore">https://zarr.readthedocs.io/en/stable/api/storage.html#zarr.storage.DBMStore</a>&gt;`__ then the store data <strong>are not</strong> pickled. The only thing that is pickled is the necessary parameters to allow the store to re-open any underlying files or databases upon being unpickled.</p>
<p>E.g., pickle/unpickle an in-memory array:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[140]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">z1</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>
<span class="c1"># Relatively large because data have been pickled</span>
<span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[140]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[141]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">z1</span> <span class="o">==</span> <span class="n">z2</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[141]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[142]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">z1</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">z2</span><span class="p">[:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[142]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>E.g., pickle/unpickle an array stored on disk:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[143]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z3</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/walnuts.zarr&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i8&#39;</span><span class="p">)</span>
<span class="n">z3</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">z3</span><span class="p">)</span>
<span class="c1"># Small because no data have been pickled</span>
<span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[143]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[144]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z4</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">z3</span> <span class="o">==</span> <span class="n">z4</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[144]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[145]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">z3</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">z4</span><span class="p">[:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[145]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>##Datetimes and Timedeltas</p>
<p>NumPy’s <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> (‘M8’) and <code class="docutils literal notranslate"><span class="pre">timedelta64</span></code> (‘m8’) dtypes are supported for Zarr arrays, as long as the units are specified. E.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[146]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2007-07-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2006-01-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-08-13&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[D]&#39;</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[146]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;zarr.core.Array (3,) datetime64[D]&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;2007-07-13&#39;, &#39;2006-01-13&#39;, &#39;2010-08-13&#39;], dtype=&#39;datetime64[D]&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[148]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[148]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
numpy.datetime64(&#39;2007-07-13&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[149]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1999-12-31&#39;</span>
<span class="n">z</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[149]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;1999-12-31&#39;, &#39;2006-01-13&#39;, &#39;2010-08-13&#39;], dtype=&#39;datetime64[D]&#39;)
</pre></div></div>
</div>
<p>##Usage Tips</p>
<p>###Copying Large Arrays</p>
<p>Data can be copied between large arrays without needing much memory, e.g.:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[150]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z1</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i4&#39;</span><span class="p">)</span>
<span class="n">z1</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">z2</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>
<span class="n">z2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">z1</span>
</pre></div>
</div>
</div>
<p>Internally the example above works chunk-by-chunk, extracting only the data from <code class="docutils literal notranslate"><span class="pre">z1</span></code> required to fill each chunk in <code class="docutils literal notranslate"><span class="pre">z2</span></code>. The source of the data (<code class="docutils literal notranslate"><span class="pre">z1</span></code>) could equally be an h5py Dataset.</p>
<p>###Configuring Blosc</p>
<p>The Blosc compressor is able to use multiple threads internally to accelerate compression and decompression. By default, Blosc uses up to 8 internal threads. The number of Blosc threads can be changed to increase or decrease this number, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[151]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numcodecs</span> <span class="kn">import</span> <span class="n">blosc</span>
<span class="n">blosc</span><span class="o">.</span><span class="n">set_nthreads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[151]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4
</pre></div></div>
</div>
<p>When a Zarr array is being used within a multi-threaded program, Zarr automatically switches to using Blosc in a single-threaded “contextual” mode. This is generally better as it allows multiple program threads to use Blosc simultaneously and prevents CPU thrashing from too many active threads. If you want to manually override this behaviour, set the value of the <code class="docutils literal notranslate"><span class="pre">blosc.use_threads</span></code> variable to <code class="docutils literal notranslate"><span class="pre">True</span></code> (Blosc always uses multiple internal threads) or <code class="docutils literal notranslate"><span class="pre">False</span></code> (Blosc always runs in
single-threaded contextual mode). To re-enable automatic switching, set <code class="docutils literal notranslate"><span class="pre">blosc.use_threads</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Please note that if Zarr is being used within a multi-process program, Blosc may not be safe to use in multi-threaded mode and may cause the program to hang. If using Blosc in a multi-process program then it is recommended to set <code class="docutils literal notranslate"><span class="pre">blosc.use_threads</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">test</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Filters</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to test’s documentation!</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Gbotemi.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/tutorial_nb.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>